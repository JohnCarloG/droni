<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Droni Delivery</title>
    
    <!-- Custom Design System -->
    <link rel="stylesheet" href="/static/css/design-system.css">
</head>
<body>
    <!-- Navbar -->
    <header class="navbar">
        <div class="container flex justify-between items-center">
            <a href="/admin" class="navbar-brand">‚öôÔ∏è Droni Delivery Admin</a>
            <nav>
                <ul class="navbar-nav">
                    <li><a href="#" class="nav-link active" data-view="dashboard">Dashboard</a></li>
                    <li><a href="#" class="nav-link" data-view="droni">Droni</a></li>
                    <li><a href="#" class="nav-link" data-view="piloti">Piloti</a></li>
                    <li><a href="#" class="nav-link" data-view="missioni">Missioni</a></li>
                    <li><a href="#" class="nav-link" data-view="ordini">Ordini</a></li>
                    <li><a href="#" class="nav-link" data-view="report">Report</a></li>
                    <li><a href="#" class="nav-link" data-view="analytics">Analytics</a></li>
                    <li><a href="/" class="nav-link text-danger">‚Üê Esci</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container py-6">
        <!-- Dashboard View -->
        <div id="dashboard-view" class="view-section">
            <div class="flex justify-between items-center mb-6">
                <h1>üìä Dashboard Operativa</h1>
                <button class="btn btn-secondary btn-sm" onclick="loadDashboard()">üîÑ Aggiorna</button>
            </div>
            
            <!-- Statistics Cards -->
            <div class="grid grid-cols-4 gap-4 mb-6">
                <div class="stat-card text-center">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üöÅ</div>
                    <div class="stat-value" id="stat-droni">0</div>
                    <div class="stat-label">Droni Attivi</div>
                </div>
                <div class="stat-card text-center">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üîÑ</div>
                    <div class="stat-value" id="stat-missioni-corso">0</div>
                    <div class="stat-label">Missioni in Corso</div>
                </div>
                <div class="stat-card text-center">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚úÖ</div>
                    <div class="stat-value" id="stat-missioni-completate">0</div>
                    <div class="stat-label">Completate</div>
                </div>
                <div class="stat-card text-center">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚≠ê</div>
                    <div class="stat-value" id="stat-valutazione">0.0</div>
                    <div class="stat-label">Valutazione Media</div>
                </div>
            </div>

            <!-- Recent Missions -->
            <div class="card">
                <h3 class="card-title">üöÄ Missioni Recenti</h3>
                <div id="recent-missions"></div>
            </div>
        </div>

        <!-- Droni View -->
        <div id="droni-view" class="view-section" style="display: none;">
            <div class="flex justify-between items-center mb-6">
                <h1>üöÅ Gestione Droni</h1>
                <button class="btn btn-primary" onclick="showAddDroneForm()">+ Nuovo Drone</button>
            </div>

            <div class="table-wrapper">
                <table class="table" id="droni-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Modello</th>
                            <th>Capacit√† (kg)</th>
                            <th>Batteria (%)</th>
                            <th>Stato</th>
                            <th>Azioni</th>
                        </tr>
                    </thead>
                    <tbody id="droni-tbody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Missioni View -->
        <div id="missioni-view" class="view-section" style="display: none;">
            <h1 class="mb-6">üìã Tutte le Missioni</h1>

            <!-- Filters -->
            <div class="card mb-4">
                <div class="form-group mb-0">
                    <label class="form-label">Filtra per stato:</label>
                    <select class="form-control" id="filter-stato" onchange="loadMissioni()" style="max-width: 200px;">
                        <option value="">Tutti</option>
                        <option value="programmata">Programmata</option>
                        <option value="in corso">In Corso</option>
                        <option value="completata">Completata</option>
                        <option value="annullata">Annullata</option>
                    </select>
                </div>
            </div>

            <div class="table-wrapper">
                <table class="table" id="missioni-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Data</th>
                            <th>Drone</th>
                            <th>Pilota</th>
                            <th>Stato</th>
                            <th>Valutazione</th>
                        </tr>
                    </thead>
                    <tbody id="missioni-tbody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Ordini View -->
        <div id="ordini-view" class="view-section" style="display: none;">
            <h1 class="mb-6">üì¶ Tutti gli Ordini</h1>

            <div class="table-wrapper">
                <table class="table" id="ordini-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Cliente</th>
                            <th>Tipo</th>
                            <th>Peso (kg)</th>
                            <th>Destinazione</th>
                            <th>Stato</th>
                        </tr>
                    </thead>
                    <tbody id="ordini-tbody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Piloti View -->
        <div id="piloti-view" class="view-section" style="display: none;">
            <div class="flex justify-between items-center mb-6">
                <h1>üë®‚Äç‚úàÔ∏è Gestione Piloti</h1>
                <button class="btn btn-primary" onclick="showAddPilotaForm()">+ Nuovo Pilota</button>
            </div>

            <div class="table-wrapper">
                <table class="table" id="piloti-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>Cognome</th>
                            <th>Email</th>
                            <th>Licenza</th>
                            <th>Missioni</th>
                            <th>Azioni</th>
                        </tr>
                    </thead>
                    <tbody id="piloti-tbody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Report View -->
        <div id="report-view" class="view-section" style="display: none;">
            <div class="flex justify-between items-center mb-6">
                <h1>üìà Report e Statistiche</h1>
                <button class="btn btn-primary" onclick="exportReport()">üì• Esporta CSV</button>
            </div>

            <div class="grid grid-cols-2 gap-6 mb-6">
                <!-- Statistiche Missioni -->
                <div class="card">
                    <h3 class="card-title">üìä Statistiche Missioni</h3>
                    <div id="report-missioni-stats"></div>
                </div>

                <!-- Statistiche Droni -->
                <div class="card">
                    <h3 class="card-title">üöÅ Performance Droni</h3>
                    <div id="report-droni-stats"></div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-6">
                <!-- Top Piloti -->
                <div class="card">
                    <h3 class="card-title">üèÜ Top Piloti per Valutazione</h3>
                    <div id="report-top-piloti"></div>
                </div>

                <!-- Distribuzione Consegne -->
                <div class="card">
                    <h3 class="card-title">üì¶ Distribuzione Consegne</h3>
                    <div id="report-consegne"></div>
                </div>
            </div>
        </div>

        <!-- Analytics / ML View -->
        <div id="analytics-view" class="view-section" style="display: none;">
            <h1 class="mb-6">ü§ñ Analisi Predittive (Machine Learning)</h1>

            <div class="grid grid-cols-2 gap-6 mb-6">
                <!-- Previsione Domanda -->
                <div class="card">
                    <h3 class="card-title">üìà Previsione Domanda</h3>
                    <p class="text-gray-500 mb-4">Stima del carico di lavoro basata sui dati storici</p>
                    <div id="ml-demand-prediction">
                        <div class="stat-card mb-3">
                            <div class="stat-label">Prossima settimana</div>
                            <div class="stat-value" id="ml-next-week">--</div>
                            <p class="text-sm text-gray-500">ordini stimati</p>
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="runDemandPrediction()">Calcola Previsione</button>
                    </div>
                </div>

                <!-- Ottimizzazione Rotte -->
                <div class="card">
                    <h3 class="card-title">üó∫Ô∏è Analisi Percorsi</h3>
                    <p class="text-gray-500 mb-4">Analisi delle tracce di volo per ottimizzazione</p>
                    <div id="ml-route-analysis">
                        <div class="stat-card mb-3">
                            <div class="stat-label">Tempo medio consegna</div>
                            <div class="stat-value" id="ml-avg-time">--</div>
                            <p class="text-sm text-gray-500">minuti</p>
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="runRouteAnalysis()">Analizza Percorsi</button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-6">
                <!-- Predizione Manutenzione -->
                <div class="card">
                    <h3 class="card-title">üîß Manutenzione Predittiva</h3>
                    <p class="text-gray-500 mb-4">Previsione necessit√† manutenzione droni</p>
                    <div id="ml-maintenance">
                        <div class="table-wrapper">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Drone</th>
                                        <th>Batteria</th>
                                        <th>Missioni</th>
                                        <th>Stato</th>
                                    </tr>
                                </thead>
                                <tbody id="ml-maintenance-tbody"></tbody>
                            </table>
                        </div>
                        <button class="btn btn-primary btn-sm mt-3" onclick="runMaintenancePrediction()">Calcola</button>
                    </div>
                </div>

                <!-- Analisi Valutazioni -->
                <div class="card">
                    <h3 class="card-title">‚≠ê Sentiment Analysis</h3>
                    <p class="text-gray-500 mb-4">Analisi dei commenti delle valutazioni</p>
                    <div id="ml-sentiment">
                        <div class="flex gap-4 mb-4">
                            <div class="stat-card text-center" style="flex: 1;">
                                <div class="stat-value text-success" id="ml-positive">--</div>
                                <div class="stat-label">Positivi</div>
                            </div>
                            <div class="stat-card text-center" style="flex: 1;">
                                <div class="stat-value text-gray-500" id="ml-neutral">--</div>
                                <div class="stat-label">Neutri</div>
                            </div>
                            <div class="stat-card text-center" style="flex: 1;">
                                <div class="stat-value text-danger" id="ml-negative">--</div>
                                <div class="stat-label">Negativi</div>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="runSentimentAnalysis()">Analizza</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Loading -->
    <div id="loading" style="display: none; position: fixed; inset: 0; background: rgba(255,255,255,0.9); display: flex; align-items: center; justify-content: center; z-index: 999;">
        <div style="width: 40px; height: 40px; border: 3px solid var(--gray-200); border-top-color: var(--blue-600); border-radius: 50%; animation: spin 0.6s linear infinite;"></div>
    </div>

    <!-- Add Drone Modal -->
    <div id="add-drone-modal" class="modal-backdrop" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Aggiungi Nuovo Drone</h3>
                <button class="btn btn-secondary btn-sm" onclick="closeAddDroneForm()">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="add-drone-form">
                    <div class="form-group">
                        <label class="form-label">Modello</label>
                        <input type="text" class="form-control" id="drone-modello" placeholder="DJI Phantom 5" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Capacit√† (kg)</label>
                        <input type="number" step="0.01" class="form-control" id="drone-capacita" placeholder="2.5" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Batteria (%)</label>
                        <input type="number" min="0" max="100" class="form-control" id="drone-batteria" placeholder="100" required>
                    </div>
                    <div class="modal-footer" style="padding: 0; border: none; margin-top: 1.5rem;">
                        <button type="button" class="btn btn-secondary" onclick="closeAddDroneForm()">Annulla</button>
                        <button type="submit" class="btn btn-primary">Salva Drone</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Pilota Modal -->
    <div id="add-pilota-modal" class="modal-backdrop" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Aggiungi Nuovo Pilota</h3>
                <button class="btn btn-secondary btn-sm" onclick="closeAddPilotaForm()">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="add-pilota-form">
                    <div class="form-group">
                        <label class="form-label">Nome</label>
                        <input type="text" class="form-control" id="pilota-nome" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cognome</label>
                        <input type="text" class="form-control" id="pilota-cognome" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="pilota-email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Numero Licenza</label>
                        <input type="text" class="form-control" id="pilota-licenza" required>
                    </div>
                    <div class="modal-footer" style="padding: 0; border: none; margin-top: 1.5rem;">
                        <button type="button" class="btn btn-secondary" onclick="closeAddPilotaForm()">Annulla</button>
                        <button type="submit" class="btn btn-primary">Salva Pilota</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <style>
        @keyframes spin { to { transform: rotate(360deg); } }
        .text-success { color: var(--green-600); }
        .text-danger { color: var(--red-600); }
    </style>

    <script src="/static/js/admin.js"></script>
</body>
</html>
